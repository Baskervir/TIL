# 복합 기본 키
## 개념
+ 두 개 이상의 컬럼을 조합하여 하나의 기본 키를 구성하는 것
+ 주로 연결 테이블, 조인 테이블 등에서 사용한다

## 구현 방법
| 방법 | 설명 |
| --- | --- |
| @IdClass | 별도 키 클래스를 생성하여 사용하는 방법 (외부 클래스 이용) |
| @EmbeddedId | 복합 키를 Embeddable 클래스로 묶어서 사용하는 방법 |
`가독성 및 일관성의 이유로 @EmbeddedId가 선호된다`

---

# 식별 관계
## 개념
+ 부모 테이블의 기본 키를 자식 테이블이 자신의 기본 키로 사용하는 관계
+ 자식 테이블이 부모의 식별자(PK)를 복합 키로 삼는다

## 특징
+ 부모가 삭제되면 자식도 삭제되는 강한 의존성 (Cascade)
+ 연관관계 매핑 시, 복합 키 사용이 필수적이다
`부모의 생명주기를 사직이 강하게 따라가는 경우에 사용한다`

---

# 다대다 : 새로운 기본 키 사용
## 개념
+ 다대다 관계를 연결할 때, 기존 두 외래 키를 합치는 대신<br> 별도의 새로운 기본 키를 만들어 연결 엔티티에 부여한다

## 장점
+ 단순하고 명확한 식별자 사용 가능
+ 성능 최적화 (조인 조건 간결화)
+ 복합 키를 사용하는 것보다 관리가 쉽다

### 주의사항
+ 연결 엔티티를 완전한 독립 엔티티로 보는 설계가 된다<br> 새로운 PK를 부여하면 복잡한 복합키 문제를 피할 수 있다

---

# 다대다 : 연관관계 정리
## 순수 @ManyToMany
+ 중간 테이블을 자동으로 생성
+ 추가 컬럼 불가
+ 실무에서는 거의 사용하지 않음

## 연결 엔티티 승격
+ 별도의 연결 엔티티 생성
+ 추가 정보(수량, 날짜 등) 저장 가능
+ 다대다 -> 일대다/다대일 구조로 풀어서 매핑

## 양방뱡 다대다
+ 양쪽 모두 서로를 참조
+ 주인은 반드시 한 쪽에서 설정 (@JoinTable)
+ 반대편은 `mappedBy`사용
`실무에서는 항상 "연결 엔티티 승격 + 별도 PK 생성" 패턴을 추천한다`

---

# 연관관계 주인/비주인 매핑 방법
## 주인 쪽 매핑
+ 연관관계의 주인은 `@JoinColumn` 어노테이션을 사용하여 외래 키를 명시적으로 매핑한다
+ `name`속성을 통해 현재 테이블에 생성될 외래 키 컬럼명을 지정한다
```declarative
@ManyToOne  // 연관관계의 주인
@JoinColumn(name = "target_id") // 현재 테이블에 생성될 FK 이름
private TargetEntity target;
```

## 비주인 쪽 매핑
+ 연관관계의 비주인 쪽은 `mappedBy` 속성으 ㄹ사용하여 주인 엔티티의 필드명을 명시한다
+ 외래 키를 직접 관리하지 않고, 단순히 읽기 전용 매핑을 수행한다
```declarative
@OneToMany(mappedBy = "target") // 주인 쪽 필드명
private List<ThisEntity> thisEntities;
```

## Tips
+ 주인 쪽에 `@JoinColumn`을 꼭 명시!
+ 비주인 쪽은 절대 외래 키를 조작하지 않는다 (조회만)
+ `mappedBy`는 주인의 ***필드명***을 정확히 써야 한다 (클래스명 아님)